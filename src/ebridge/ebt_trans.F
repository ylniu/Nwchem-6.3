		subroutine ebt_trans(s,h,J)
			implicit none
#include "global.fh"
#include "stdio.fh"
			real(8)      :: s(4,4)
			real(8)      :: h(4,4)
			real(8)      :: J(4,4,4,4)
			!-------------------------------------------------------------
			! hmn(:,:,i=1 or 2)
			! 1: singlet; 2: triplet
			!
			real(8)      :: Smn(4,4  )
			real(8)      :: Hmn(4,4,2)
			real(8)      :: Tmn(4,4,2)
			real(8)      :: HIJ(2,2,2)
			real(8)      :: TIJ(2,2,2)
			real(8)      :: SIJ(2,2,2)
			!-------------------------------------------------------------
			integer      :: me
			integer      :: i, k, l
			real(8)      :: JJ, J0, Z
			real(8)      :: P1, P2, PP(2), A(2), N(2)
			real(8)      :: mu(2), la(2)
			character(7) :: ex(2)
			!-------------------------------------------------------------
			me=ga_nodeid()
			!-------------------------------------------------------------
			! 1 : a
			! 2 : a'
			! 3 : b
			! 4 : b'
			!-------------------------------------------------------------
			Hmn=0.D0
			Tmn=0.D0
			Smn=0.D0
			HIJ=0.D0
			TIJ=0.D0
			SIJ=0.D0
			!-------------------------------------------------------------
			! JJ = (a'a |bb') = (21|34)
			! J0 = (a'a |aa') = (21|12)
			! Z  = (a'b'|ba ) = (24|31)
			!
			! P1 = -Sab      {ha'b'+(aa|a'b')+(bb|a'b')}
			!      -Sa'b'    {hab  +(aa|b b )+(bb|a b )}
			!      -SabSa'b' {haa  +hbb      +(aa|b b )}
			!
			! P2 =  haa + 2hbb + ha'a'
			!      +2(aa|bb) + (aa|a'a') + 2(a'a'|bb) + (bb|bb)
			!
			! PP = P1 - S14 * H11
			!
			JJ = J(2,1,3,4)
			J0 = J(2,1,1,2)
			Z  = J(2,4,3,1)
			P1 = s(1,3) *          (h(2,4)+J(1,1,2,4)+J(3,3,2,4))
     &		 +s(2,4) *          (h(1,3)+J(1,1,1,3)+J(3,3,1,3))
     &		 +s(1,3) * s(2,4) * (h(1,1)+h(3,3    )+J(1,1,3,3))
			!-------------------------------------------------------------
			P2 = h(1,1) + 2.D0 * h(3,3) + h(2,2)
     &		 +2.D0 * J(1,1,3,3) + J(1,1,2,2) + 2.D0 * J(2,2,3,3)
     &		 +J(3,3,3,3)
			!-------------------------------------------------------------
			PP(1) = P1 - Smn(1,4) * Hmn(1,1,1)
			PP(2) = P1 - Smn(1,4) * Hmn(1,1,2)
			!-------------------------------------------------------------
			! Calculate Smn
			!
			do i=1, 4
				Smn(i,i) = 1.D0
			end do
			Smn(1,2)   =  s(2,4)
			Smn(1,3)   = -s(1,3)
			Smn(1,4)   = -s(1,3) * s(2,4)
			Smn(2,3)   =  S(1,4)
			Smn(2,4)   =  S(1,3)
			Smn(3,4)   =  S(1,2)
			!-------------------------------------------------------------
			! Calculate Hmn for singlet state
			!
			Hmn(1,1,1) = P2 + J0
			Hmn(1,2,1) = h(2,4) + 2.D0 * J(2,4,3,3) + J(1,1,2,4)
     &		+ s(2,4) * ( h(1,1) + 2.D0 * h(3,3) + J(3,3,3,3) 
     &		+ 2.D0 * J(1,1,3,3) )
			Hmn(1,3,1) = -1.D0 * (h(1,3)+J(1,3,1,1)+J(1,3,3,3)+J(1,3,2,2)
     &		+ s(1,3) * (h(1,1)+h(2,2)+h(3,3)+J(2,2,1,1)
     &		+ J(2,2,3,3) + J(1,1,3,3)))
			Hmn(1,4,1) = 2*JJ - Z - P1
			Hmn(2,2,1) = h(1,1) + 2.D0 * h(3,3) + h(4,4)
     &		+2.D0 * J(1,1,3,3) + 2.D0 * J(3,3,4,4)
     &		+J(1,1,4,4) + J(3,3,3,3) - J0
			!Hmn(2,3,1) = 0.D0
			Hmn(2,4,1) = Hmn(1,3,1)
			Hmn(3,3,1) = Hmn(2,2,1)
			Hmn(3,4,1) = Hmn(1,2,1)
			!Hmn(4,4,1) = 0.D0
			!-------------------------------------------------------------
			! Calculate Hmn for triplet state
			!
			Hmn(1,1,2) = P2 - J0
			Hmn(1,2,2) = Hmn(1,2,1)
			Hmn(1,3,2) = Hmn(1,3,1)
			Hmn(1,4,2) = Hmn(1,4,1) - 2 * JJ
			Hmn(2,2,2) = Hmn(2,2,1)
			!Hmn(2,3,2) = 0.D0
			Hmn(2,4,2) = Hmn(1,3,2)
			Hmn(3,3,2) = Hmn(2,2,2)
			Hmn(3,4,2) = Hmn(1,2,1)
			!Hmn(4,4,2) = 0.D0
			!-------------------------------------------------------------
			do k=2, 4
				do l=1, k-1
					Smn(k,l) = Smn(l,k)
					do i=1, 2
						Hmn(k,l,i) = Hmn(l,k,i)
					end do
				end do
			end do
			!-------------------------------------------------------------
			do k=1, 4
				do l=1, 4
					do i=1, 2
						Tmn(k,l,i) = Hmn(k,l,i) - Smn(k,l) * Hmn(1,1,i)
					end do
				end do
			end do
			!-------------------------------------------------------------
			A(1) = Hmn(2,2,1) - Hmn(1,1,1)
			A(2) = A(1) + 2.D0 * J0
			!-------------------------------------------------------------
			do i=1, 2
				!----------------------------------------------------------
				mu(i) = -Tmn(1,2,i) / A(i)
				la(i) = -Tmn(1,3,i) / A(i)
				!----------------------------------------------------------
				N (i) = 1.D0 / sqrt(1.D0 + 2.D0 * la(i) * Smn(1,2)
     &			+ 2.D0 * mu(i) * Smn(1,3) + la(i)**2 + mu(i)**2
     &			+ 2.D0 * la(i) * mu(i) * Smn(2,3))
				!----------------------------------------------------------
				SIJ(1,1,i) = 1.D0
				SIJ(2,2,i) = 1.D0
				SIJ(1,2,i) = N(i)**2 * (Smn(1,4) + 2.D0 * la(i) * mu(i)
     &			+2.D0 * mu(i) * Smn(1,2) * 2.D0 * la(i) * Smn(1,3)
     &			+(la(i)**2 + mu(i)**2)*Smn(2,3))
				SIJ(2,1,i) = SIJ(1,2,i)
				!----------------------------------------------------------
				HIJ(1,1,i) = Hmn(1,1,i) + N(i)**2
     &			* ( (la(i)**2 + mu(i)**2)*A(i)
     &			+ 2.D0 * la(i)*Tmn(1,2,i)
     &			+ 2.D0 * mu(i) * Tmn(1,3,i)
     &			+ 2.D0 * la(i) * mu(i) * Tmn(2,3,i) )
				HIJ(2,2,i) = HIJ(1,1,i)
				HIJ(1,2,i) = SIJ(1,2,i) * Hmn(1,1,i) + N(i)**2
     &			* (Tmn(1,4,i) + 2.D0 * la(i) * mu(i) * A(i)
     &			+ 2.D0 * mu(i) * Tmn(1,2,i)
     &			+ 2.D0 * la(i) * Tmn(1,3,i)
     &			+ (la(i)**2 + mu(i)**2) * Tmn(2,3,i))
				HIJ(2,1,i) = HIJ(1,2,i)
				!----------------------------------------------------------
			end do
			ex(1) = "Singlet"
			ex(2) = "Triplet"
			if (me==0) then
				!----------------------------------------------------------
				! Output Smn
				!
				write(LuOut,'(2x,"Smn")')
				do k=1, 4
					write(LuOut,'(4x, 4f15.7)') (Smn(k,l), l=1,4)
				end do
				do i=1, 2
					write(LuOut,'(2x,"Trans for ",a," state")') ex(i)
					!-------------------------------------------------------
					! Output Hmn
					!
					write(LuOut,'(2x,"Hmn")')
					do k=1, 4
						write(LuOut,'(4x, 4f15.7)') (Hmn(k,l,i), l=1,4)
					end do
					!-------------------------------------------------------
					! Output Tmn
					!
					write(LuOut,'(2x,"Tmn")')
					do k=1, 4
						write(LuOut,'(4x, 4f15.7)') (Tmn(k,l,i), l=1,4)
					end do
					!-------------------------------------------------------
					! Output SIJ
					!
					write(LuOut,'(2x,"SIJ")')
					do k=1, 2
						write(LuOut,'(4x, 4f15.7)') (SIJ(k,l,i), l=1,2)
					end do
					!-------------------------------------------------------
					! Output HIJ
					!
					write(LuOut,'(2x,"HIJ")')
					do k=1, 2
						write(LuOut,'(4x, 4f15.7)') (HIJ(k,l,i), l=1,2)
					end do
					!-------------------------------------------------------
					! Output N, A, mu, la
					!
					write(LuOut,'(2x,"N     ",4x,f15.7)') N (i)
					write(LuOut,'(2x,"A     ",4x,f15.7)') A (i)
					write(LuOut,'(2x,"mu    ",4x,f15.7)') mu(i)
					write(LuOut,'(2x,"lambda",4x,f15.7)') la(i)
					!-------------------------------------------------------
				end do
			end if
			return
		end subroutine
